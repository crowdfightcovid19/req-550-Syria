\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{mathtools}

\title{Derivation of R0}

\begin{document}

\maketitle

\subsection*{Reference and general idea}

The derivation of R0 for a SIR type model following description of 'Mathematical Tools for Understanding Infectious Disease Dynamics' written by Odo Diekmann, Hans Heesterbeek and Tom Britton. 
See chapter 7, section 2 'Next-generation matrix for compartmental systems'. 
We use 4 steps to find the basic reproduction number of a system.
1) Define the infected subsystem, i.e. all equations that include compartments where individuals can get infected. 
2) Linearize the subsystem in the disease free equilibrium. 
3) Find the next generation matrix (NGM) with large domain ($K_L$) by writing the linear system as: $\dot{x} = (T + \Sigma) x$, here $x$ is a vector containing all states where individuals can get infected, $T$ contains all terms corresponding to transmission and $\Sigma$ all terms corresponding to duration of stay in a compartment. Then: $NGM = -T \Sigma^{-1}. $
4) The reproduction number is now the dominant eigenvalue of the NGM. 
We also reference the description of R0 in metapopulations in Philipps S, Rossi D. Mathematical Models of Infectious Diseases: Two-Strain Infections in Metapopulations, and the methodology for calculating R0 used by the authors in Gatto M, Bertuzzo E, Mari L, Miccoli S, Carraro L, Casagrandi R, et al. Spread and dynamics of the COVID-19 epidemic in Italy: Effects of emergency containment measures. PNAS. 2020 May 12;117(19):10484â€“91.


\subsection*{Derivation}

The infected subsystem is the following: 

\begin{gather*}
    \dot{E}_i =  \lambda_i S_i - \delta_E E_i \\
    \dot{P}_i = \delta_E E_i - \delta_p P_i \\
    \dot{A}_i = (1-f) \delta_p P_i - \gamma_A A_i \\
    \dot{I}_i = f \delta_p P_i - ((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha) I_i \\   
    \dot{H}_i = h_i \eta I_i - \gamma_H H_i   
\end{gather*}

Where, 
\begin{gather*}
   \lambda_i = \sum_{j = 1}^n C_{ij} \frac{\beta_P P_j + \beta_A A_j + \beta_I I_j + \beta_H H_j}{N_j}
\end{gather*}

And $C_{ij}$ is the contact matrix, the probability that individuals who are from population class $i$ come into contact with individuals who are from population class $j$.

\noindent
After linearizing we can write it in the form of $\dot{x} = (T + \Sigma) x$, this gives us:

\begin{gather}
 T =
  \begin{bmatrix}
   \boldsymbol{0} & \boldsymbol{\beta_P} \boldsymbol{\Theta} & 
   \boldsymbol{\beta_A} \boldsymbol{\Theta} &
   \boldsymbol{\beta_I} \boldsymbol{\Theta} &
   \boldsymbol{\beta_H} \boldsymbol{\Theta} \\
   \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0}
   \end{bmatrix}
\end{gather}

\begin{gather}
 \Sigma =
  \begin{bmatrix}
   - \delta_E \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   \delta_E \boldsymbol{I}& -\delta_p \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   \boldsymbol{0} & (1-f) \delta_p \boldsymbol{I} & -\gamma_A \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} \\
   \boldsymbol{0} & f \delta_p \boldsymbol{I} & \boldsymbol{0} & - ((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha) \boldsymbol{I} & \boldsymbol{0} \\
   \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & h_i \eta \boldsymbol{I} & -\gamma_H \boldsymbol{I}
   \end{bmatrix}
\end{gather}

Where $\boldsymbol{I}$ and $\boldsymbol{0}$ are the identity and null matrices of size n. \\

$\boldsymbol{\beta_P}$, $\boldsymbol{\beta_A}$, $\boldsymbol{\beta_I}$, and $\boldsymbol{\beta_H}$ are diagonal matrices whose nonzero elements are the transmission parameters, $\beta$, for each population class for that specific infectious compartment. To illustrate using the 5 population classes in our model:
\begin{gather}
   \boldsymbol{\beta_i} (i \in \{P,A,I,H\}) = 
   \begin{bmatrix}
   \beta_{i,age1} & 0 & 0 & 0 & 0 \\
   0 & \beta_{i,age2nocomorbid} & 0 & 0 & 0 \\
   0 & 0 & \beta_{i,age2comorbid} & 0 & 0 \\
   0 & 0 & 0 & \beta_{i,age3nocomorbid} & 0 \\
   0 & 0 & 0 & 0 & \beta_{i,age3comorbid}
   \end{bmatrix}
\end{gather}

Since children in our model on average make twice as many contacts as adults and the elderly, we have:
\begin{gather*}
   \beta_{i,age1} = 2\beta_{i,age2nocomorbid} =  2\beta_{i,age2comorbid} = 2\beta_{i,age3nocomorbid} = 2\beta_{i,age3comorbid}
\end{gather*}\\
\newpage

Let $\boldsymbol{\Theta} = \boldsymbol{N} \boldsymbol{C} \boldsymbol{N}^{-1}$\\

Where $\boldsymbol{N}$ is a diagonal matrix whose nonzero elements are the relative sizes of each population class, $N_i$, and $\boldsymbol{C}$ is the contact matrix whose rows are the contact probabilities for each population class, $C_{ij}$, each summing to 1.\\

Now we can find the inverse of $\Sigma$, $\Sigma^{-1} = $
\\
\noindent
\[
  \begin{bmatrix}  
   - \frac{1}{\delta_E} \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   -\frac{1}{\delta_p} \boldsymbol{I} & -\frac{1}{\delta_p} \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} & \boldsymbol{0} \\
   -\frac{(1-f)}{\gamma_A} \boldsymbol{I} & -\frac{(1-f)}{\gamma_A} \boldsymbol{I} & -\frac{1}{\gamma_A} \boldsymbol{I} & \boldsymbol{0} & \boldsymbol{0} \\
   -\frac{f}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)} \boldsymbol{I} & -\frac{f}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)} \boldsymbol{I} & \boldsymbol{0} & -\frac{1}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)} \boldsymbol{I} & \boldsymbol{0} \\
   -\frac{fh_i \eta}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)\gamma_H} \boldsymbol{I} & -\frac{fh_i \eta}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)\gamma_H} \boldsymbol{I} & \boldsymbol{0} & -\frac{h_i \eta}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)\gamma_H} \boldsymbol{I} & -\frac{1}{\gamma_H} \boldsymbol{I} 
   \end{bmatrix}
\]
\\
The NGM with large domain can now be found by $K_L = - T \Sigma^{-1}$, however, as we know that each individual that gets infected first will go to the $E$ compartment we can instead calculate the NGM with small domain that only consists of the $E$ compartment.
We do this by removing from $T$ the rows that correspond to the other compartments and from $\Sigma^{-1}$ the columns. 
We then find: 

\begin{gather*}
\boldsymbol{K} = \frac{1}{\delta_P} \boldsymbol{\beta_P} \boldsymbol{\Theta} + \frac{(1-f)}{\gamma_A} \boldsymbol{\beta_A} \boldsymbol{\Theta} + \frac{f}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)} \boldsymbol{\beta_I} \boldsymbol{\Theta} + \frac{fh_i \eta}{((1-g_i-h_i) \gamma_{I} + h_i \eta + g_i \alpha)\gamma_H} \boldsymbol{\beta_H} \boldsymbol{\Theta}
\end{gather*}

Therefore, 

\begin{gather}
R_0 = \rho(\boldsymbol{K})
\end{gather}

\subsection*{Generalization}

This method can be generalized for a structured population by including all subpopulations in the matrix notation. For instance for 6 different population classes (taking into account 3 age groups and comorbidity status), we would obtain a NGM with small domain of 6x6, as an individual can end up in one of those stages after getting infected. 

\end{document}
